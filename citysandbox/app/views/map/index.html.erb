<script type="text/javascript">
$(document).ready( function() {
	var loc = '<% if User.exists? and current_user %> <%= current_user.location %> <% else %><%= @location %><% end %>';
	var lat = 0;
	var lng = 0;
	//var center;
	var map;
	// var question_layer;
	// 	var challenge_layer;
	// 	var event_layer;
	var geocoder = new google.maps.Geocoder();
	geocoder.geocode( { 'address': loc}, function(results, status) {
	      if (status == google.maps.GeocoderStatus.OK) {
	        lat = results[0].geometry.location.lat();
			lng = results[0].geometry.location.lng();
			
			make_map(lat, lng);
			/*{
			  query: {
			    select: 'Location',
			    from: '1943371'
			  },
			  map: map,
			  styles: [{
			    markerOptions: {
			      iconName: "large_green"
			    }
			  }]
			});
			
			challenge_layer = new google.maps.FusionTablesLayer({
			  query: {
			    select: 'Location',
			    from: '1943952'
			  },
			  map: map,
			  styles: [{
			    markerOptions: {
			      iconName: "large_blue"
			    }
			  }]
			});
			
			event_layer = new google.maps.FusionTablesLayer({
			  query: {
			    select: 'Location',
			    from: '1943933'
			  },
			  map: map,
			  styles: [{
			    markerOptions: {
			      iconName: "large_red"
			    }
			  }]
			});
			*/
		}
	});
});
function make_map(lat, lng) {
	var center = new google.maps.LatLng(lat, lng);
	map = new google.maps.Map(document.getElementById('mapview_map'), {
	  center: center,
	  zoom: 12,
	  mapTypeId: google.maps.MapTypeId.ROADMAP
	});
	
	question_layer = new google.maps.FusionTablesLayer({
		query: {
			select: 'Location',
			from: '1943933'
		},
		styles: [{
			markerOptions: {
				iconName: "large_green"
			}
		}],
		map: map
	});
	// question_layer.setMap(map);
	
	challenge_layer = new google.maps.FusionTablesLayer({
		query: {
			select: 'Location',
			from: '1943952'
		},
		styles: [{
			markerOptions: {
				iconName: "large_blue"
			}
		}],
		map: map
	});
	// challenge_layer.setMap(map);
	
	event_layer = new google.maps.FusionTablesLayer({
		query: {
			select: 'Location',
			from: '1943933'
		},
		styles: [{
			markerOptions: {
				iconName: "large_red"
			}
		}],
		map: map
	});
	// event_layer.setMap(map);
	
	// question_layer = new google.maps.FusionTablesLayer(1943371);
	// question_layer.setQuery("SELECT 'Location' FROM 1943371");
	// var question_style = new google.maps.FusionTablesLayerOptions({
	// 	styles: [{
	// 		markerOptions: {
	// 			iconName: "large_green"
	// 		}
	// 	}]
	// });
	// question_layer.setOptions(question_style);
	// question_layer.setOptions({
	// 	styles: [{
	// 		markerOptions: {
	// 			iconName: "large_green"
	// 		}
	// 	}]
	// });
	// question_layer.setMap(map);
	// 
	// 
	// challenge_layer = new google.maps.FusionTablesLayer(1943952);
	// challenge_layer.setQuery("SELECT 'Location' FROM 1943952");
	// challenge_layer.setMap(map);
	// 
	// event_layer = new google.maps.FusionTablesLayer(1943933);
	// event_layer.setQuery("SELECT 'Location' FROM 1943933");
	// event_layer.setMap(map);
}
</script>

<div id='sidebar'>
<div id='filters_content'>
	<b>SORT ITEMS BY</b>	
	<br>

	<ul id='sortby'>
	<li>
	  <%= check_box_tag 'sort', 'recent' %> Most Recent
	</li>
	<!--<li>
	  <%= check_box_tag 'sort', 'popular' %> Most Popular
	</li>--> 
	<li>
	 <%= check_box_tag 'sort', 'following' %> Following
	</li>
	</ul>
	<br>
	<b>SHOW</b>
	<ul id='sort_by_type'>
	<li>
	  <%= check_box_tag 'sort', 'Questions' %> Questions
	</li>
	<li>
	  <%= check_box_tag 'sort', 'Challenges' %> Challenges
	</li>
	<li>
	 <%= check_box_tag 'sort', 'Events' %> Events
	</li>

	</ul>
	<br>
	<b>KEYWORD SEARCH</b>
	<br>
	<%= image_tag "../images/textbox.png", :class=>'textbox' %>
	<br><br>
	<b>SHOW ITEMS FROM</b>
	<br>
	<%= image_tag "../images/textbox.png", :class=>'textbox' %>
	<br><br>
	<b>VIEW CATEGORIES</b>
	<ul id='categories'>
	<% for category in Categories.find(:all) %>
	<li>
	  <%= check_box_tag 'category', category.id %>
	  <%= category.category %>
	</li>
	<% end %>
	</ul>
	<br>
	<%= check_box_tag 'uncheck', 'Uncheck All' %> Uncheck All
</div>
</div>
<div id='mapview_map'></div>