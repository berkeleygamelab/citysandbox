<script type="text/javascript"
        src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
<style type="text/css">
#question_main, .individual_response, #response_form, .individual_challenge, #challenge_form {
	padding: 5%;
	background-color: rgba(255, 255, 255, 0.6);
}

.individual_response {
	padding-top: 2%;
	padding-bottom: 2%;
}

#question_map {
	float:right;
	width:200px;
	padding-left:20px;
	padding-bottom:10px;
}
#question_title {
	font-size: 25px;
}

#sidebar {
	float: right;
	width: 25%;
	padding-left: 2%;
	min-height: 97%;
	background-color: rgba(255, 255, 255, 0.6);
}
#main_content {
	width: 70%;
}
#question_description {
	font-size:13px;
}
#map_canvas {
	height:200px;
	width:200px;
}
</style>
<script type="text/javascript">
$(document).ready( function() {
	$('#sidebar').stickySidebar();
	
	var map;
    var myOptions = {
    	zoom: 8,
    	center: new google.maps.LatLng(37.87159260,-122.2727470),
    	mapTypeId: google.maps.MapTypeId.ROADMAP
	};
   	map = new google.maps.Map(document.getElementById('map_canvas'), myOptions);

    var geocoder = new google.maps.Geocoder();
	var address = $('#question_location').val();
	    geocoder.geocode( { 'address': address}, function(results, status) {
	      if (status == google.maps.GeocoderStatus.OK) {
	        map.setCenter(results[0].geometry.location);
	        var marker = new google.maps.Marker({
	            map: map,
	            position: results[0].geometry.location
	        });
	      } else {
	        alert("Geocode was not successful for the following reason: " + status);
	      }
	});
});
</script>
<div id='sidebar'>
		Related Content 
		
</div>
<div id='main_content'>
<div id='question_main'>
	<span id='question_map'>
		<div id="map_canvas"></div>
		<br>
		<%=h @question.location %>
		<%= hidden_field(:question, :location) %>
		
	</span>
	<span id='question_title'>
		<%= @question.title %>
	</span>
	<br><br>
	<span id='question_author'>
		<%= @question.user.picture %> by 
		<%= @question.user.login %> | 
	</span>
	<span id='question_time'>
		<%= time_ago_in_words(@question.created_at) %> ago
	</span>
	<br><br>
	<span id='question_description'>
	  <%=h @question.description %>
	</span>
</div>

<div id='responses'>
	<% @question.responses.each do |r| %>
		<br>
		<div class='individual_response'>
		    <%= @question.user.picture %>
		 	<%=h r.user.login %> |
		    <%= time_ago_in_words(r.created_at) %> ago
			<br><br>
		    <%=h r.response %>
		</div>
	<% end %>
	<br>
	<div id='response_form'>
		Add Response
		<br>
		<%= form_for [@question, Response.new] do |r| %>
		    <%= r.text_area :response, :rows => 3 %>
			<br>
		    <%= r.submit "Submit" %>
		<% end %>
	</div>
</div>

<div id='challenges'>
	<% @question.challenges.each do |c| %>
	  <br>
		<div class='individual_challenge'>
	   		<%= time_ago_in_words(c.created_at) %> ago
			<br>
		    <b><%=h c.title %></b>
			<br>
		    <%=h c.description %>
			<br>
		    Proposal Deadline: <%=h c.proposal_deadline.strftime("%m/%d/%Y, %l:%M %p") %>
			<br>
		    Review Deadline: <%=h c.review_deadline.strftime("%m/%d/%Y, %l:%M %p") %>
			<br>
		    Vote Deadline: <%=h c.vote_deadline.strftime("%m/%d/%Y, %l:%M %p") %>
		</div>
	<% end %>
	<br>
	<div id='challenge_form'>
		Add Challenge
		<br>
		<%= form_for [@challenge, Challenge.new] do |c| %>
		  <p>
		    <%= c.label :title, "Title" %><br />
		    <%= c.text_field :title %>
		  </p>
			<%= c.hidden_field :question_id, :value => @question.id %>
		  <p>
		    <%= c.label :description, "Description" %><br />
		    <%= c.text_area :description %>
		  </p>
  
		  <p>
		    <%= c.label :proposal_deadline, "Proposal Deadline" %><br />
		    <%= c.datetime_select :proposal_deadline %>
		  </p>

		  <p>
		    <%= c.label :review_deadline , "Review Deadline" %><br />
		    <%= c.datetime_select :review_deadline %>
		  </p>

		  <p>
		    <%= c.label :vote_deadline , "Vote Deadline" %><br />
		    <%= c.datetime_select :vote_deadline %>
		  </p>

		  <p>
		    <%= c.submit "Submit" %>
		  </p>
		<% end %>
</div>

<% if @question.user == current_user %>
	<%= link_to 'Edit', edit_question_path(@question), :class=>'gray_text' %> |
<% end %>
<%= link_to 'Back To Questions', questions_path, :class=>'gray_text' %>
</div>
</div>
